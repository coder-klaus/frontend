## `__dirname` 和 `__pathname`

在CJS中，每个模块文件都是一个绝对路径，可以通过`__dirname`和`__pathname` 获取文件名和工作目录

```js
console.log(__dirname) // /Users/klaus/Desktop/node-demo
console.log(__filename) // /Users/klaus/Desktop/node-demo/main.js
```



`__dirname` 和 `__pathname` 和 `require`以及`module`等方法一样，都属于模块级对象，严格来说并不是全局对象

但是因为在Node中，每一个JavaScript文件都是对象，因此广义上来说也可以将他们视为全局对象



但是在ESM中，每一个模块都是一个URL地址，并不是文件路径，所以不存在`__dirname`和`__pathname`。但可以通过Node提供的其它API进行模式实现

```js
import { fileURLToPath } from 'node:url'
import path from 'node:path'

// 将 url形式的文件路径转换为 绝对路径
const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

// 在ESM中，import.meta.url 返回的是当前文件的 URL 路径 
console.log(import.meta.url) // file:///Users/klaus/Desktop/node-demo/main.js

console.log(__filename) // /Users/klaus/Desktop/node-demo/main.js
console.log(__dirname) // /Users/klaus/Desktop/node-demo
```



此外，默认情况下，`import.meta`这个对象上挂载了很多当前模块对应的元信息，其中就已经包含了`filename`和`dirname`

不过这个是最新版本node才支持的，老版本node可能并不支持，存在兼容性问题

```js
console.log(import.meta.filename) // /Users/klaus/Desktop/node-demo/main.js
console.log(import.meta.dirname) // /Users/klaus/Desktop/node-demo
// 将相对路径转换为对应的url路径
console.log(import.meta.resolve('./utils/math.js')) // file:///Users/klaus/Desktop/node-demo/utils/math.js
```



## require

CJS可以加载json文件，但是ESM不可以

因为ESM的加载取决于import和export关键字，而json没有这些关键字

所以我们无法直接通过import方法读取json内容

只能通过fs模块读取为字符串内容后，再手动转换为json对象



在早期为了解决这个麻烦，我们还可以创建类似于CJS的require方法

```js
import { createRequire } from 'node:module'

// 创建类似CJS中的 require 函数
const require = createRequire(import.meta.url)

const data = require('./data.json')

console.log(data)
```



而最新的node中，提供了with关键字可以更方便的解决这个问题

```js
// 使用 with关键字就可以直接读取成json对象
// 目前 ESM只支持直接读取和解析json格式数据
import data from './data.json' with { type: 'json' }

console.log(data)
```

