模块化指的是将程序拆分成若干个独立的模块，每个模块拥有自己的作用域，内部的变量和函数不会影响到其他模块。

各个模块之间可以通过导入（import）和导出（export）来共享功能或数据。

模块化的主要目的是提升代码的可维护性，方便团队协作开发，同时也有助于代码的复用和管理。

| 特点     | 传统 `<script>` 标签方式 | 模块化方式                 |
| -------- | ------------------------ | -------------------------- |
| 代码组织 | 所有代码混在一起，容易乱 | 代码分模块，清晰有条理     |
| 复用性   | 复用麻烦，容易重复代码   | 导出导入方便，复用性强     |
| 维护性   | 修改代码容易出错         | 模块独立，改起来更安全     |
| 开发效率 | 效率低，文件多不好管理   | 模块化开发，效率高，易扩展 |



## IIFE

在早期 JavaScript 没有模块化标准时，开发者通常通过 IIFE（立即执行函数表达式）来创建私有作用域，从而模拟模块化

```js
const moudleA = (() => {
  const name = 'moudleA'
  const sayName = () => {
    console.log(name)
  }
  return {
    name,
    sayName
  }
})()

const moudleB = (() => {
  console.log(moudleA.name)
  moudleA.sayName()
})()
```

这种方式缺乏统一规范，不同开发者的实现方式可能各不相同。为了解决这一问题，社区先后提出了 AMD 和 CMD 等模块化规范。Node.js 则采用了自己的 CommonJS（CJS）规范。

直到 ES2015（ES6）发布，JavaScript 官方才推出了 ESM（ES Modules）标准，成为统一的模块化方案。如今，ESM 已成为主流，Node.js 也原生支持了 ESM。



## Node.js 开启 ESM 的方式

Node.js 支持两种主要方式来启用 ESM：

1. 在 `package.json` 中声明 `"type": "module"`

- 在项目根目录的 `package.json` 文件中添加 `"type": "module"` 字段后，**所有 `.js` 文件**将被当作 ESM 模块解析。
- 如果需要继续使用 CommonJS 语法，可以将对应的文件扩展名改为 `.cjs`

2. 使用 `.mjs` 文件扩展名

- 无论 `package.json` 是否设置 `"type"` 字段，只要文件扩展名为 `.mjs`，Node.js 都会将其视为 ESM 模块。
- 同理，`.cjs` 文件始终被当作 CommonJS 模块处理。
- 默认情况下（即未设置 `"type"` 字段时），`.js` 文件会按照 CommonJS 规范解析。