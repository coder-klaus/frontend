## 加载规则

1. 模块首次 require 时，代码会执行一次
   + 当一个模块第一次被 `require`，Node.js 会执行该模块的全部代码，并生成一个缓存。

2. 多次 require 只执行一次（利用缓存）

   - 首次加载时，`module.loaded` 为 `false`，模块代码会执行。

   - 加载完成后，`module.loaded` 变为 `true`，模块被缓存。

   - 后续再次 `require` 该模块时，直接返回缓存的 `exports`，不会重复执行模块代码。


3. Node.js 按深度优先顺序加载模块
   + 模块的加载顺序采用深度优先策略「 DFS 」。例如：

```
main.js
├── a.js
│   └── c.js
│       └── d.js
│           └── e.js
└── b.js
    ├── c.js
    └── e.js
```

Node.js 从 `main.js` 出发，优先加载 `a.js`，再递归加载 `c.js`、`d.js`、`e.js`。

回溯到 `b.js` 时，`c.js` 和 `e.js` 已经被加载过，因此不会再次执行。



## 示例

`main.js`

```js
// main.js
console.log('--- main.js start ---');
const foo1 = require('./foo');
const foo2 = require('./foo');
console.log('--- main.js end ---');
```



`foo.js`

```js
// foo.js
console.log('+++ foo.js executed +++');
```



`输出结果`

```js
--- main.js start ---
+++ foo.js executed +++
--- main.js end ---
```

其中，`foo.js`只执行了一次。