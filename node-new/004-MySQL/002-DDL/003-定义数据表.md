## 数据库元信息

```sql
-- 查询当前数据库的所有表
SHOW TABLES;

-- 查询students表的结构
DESCRIBE students;

-- 显示students表的创建语句
SHOW CREATE TABLE students;
```



## 建表

```sql
-- 最简单的建表语句 => 如果表不存在才创建, 否则会报错
CREATE TABLE IF NOT EXISTS users (
	-- 字段和类型使用空格分割
	-- 字段之间使用逗号分割，最后一个字段末尾的逗号可以省略
	name VARCHAR(10),
	age INT
);
```



### 表约束

表约束分为两大类：

- **字段约束**：针对单个字段设置的限制条件，例如 `UNIQUE`（唯一）、`NOT NULL`（非空）等。
- **表级约束**：针对整个表设置的规则，例如 `PRIMARY KEY`（主键）、`FOREIGN KEY`（外键）等。

> 可以为数据库字段添加的约束条件有限
>
> 在实际开发中，通常由前端和后端用正则表达式验证，确保合法后再存入数据库。



#### 主键约束

1. 主键约束（Primary Key）是表中最重要的约束，用于唯一标识每一条数据。
   - 主键实际上就是表的唯一索引，能够高效定位和检索特定的记录。
   - **建议**：主键最好使用一个专用、无业务含义的字段（如 `id` 字段），便于维护和扩展。

2. 主键保证表中每条记录的唯一性，并且主键字段**必须非空**，数据库系统会自动为主键字段加上 `NOT NULL` 约束。

3. 虽然表可以没有主键，但这并不推荐。
   - 如果没有显式指定主键，MySQL 通常会有如下处理方式：
     - 如果表中有第一个非空且唯一的字段，MySQL 可能会将其作为主键。
     - 如果没有这样的字段，MySQL 会在底层自动创建一个不可见的唯一非空字段充当主键。
   - 需要注意，不同 MySQL 版本或不同数据库产品的具体行为可能有所差异，这属于底层实现细节，开发者无法直接干预。
   - **强烈建议**：为每张表显式指定唯一主键，以保证数据安全和后续维护的便利性。

4. 主键可以由一个字段组成（单字段主键），也可以由多个字段组合而成（称为**联合主键**或复合主键）。

   ```sql
   CREATE TABLE order_items (
       order_id   INT,
       product_id INT,
       quantity   INT,
       price      DECIMAL(10, 2),
       PRIMARY KEY (order_id, product_id)  -- 联合主键
   );
   ```

5.  主键（`PRIMARY KEY`）既可以直接在字段定义后声明，也可以单独写成一行。

   - MySQL 最终会将主键定义转换为单独一行的表级写法。

   例如，下面的写法：

   ```sql
   CREATE TABLE order_items (
       order_id   INT  PRIMARY KEY,
       product_id INT,
       quantity   INT,
       price      DECIMAL(10, 2)
   );
   ```

   实际会被 MySQL 转换为：

   ```sql
   CREATE TABLE order_items (
       order_id   INT,
       product_id INT,
       quantity   INT,
       price      DECIMAL(10, 2),
       PRIMARY KEY (order_id)
   );
   ```

   

#### 唯一性约束

1. 使用 `UNIQUE` 约束可以保证字段的取值在表中是唯一的。
2. 与主键不同，`UNIQUE`字段允许有多个`NULL`值（除非你同时加了`NOT NULL`约束）。
   - 默认情况下，`UNIQUE` 字段可以为 `NULL`，因此可以插入多条 `NULL` 数据。
   - 也就是说，只要非 `NULL` 的值不重复即可，`NULL` 值可以有多个。
   - 如果需要既唯一又不允许为空，可以同时加上 `UNIQUE` 和 `NOT NULL` 约束。



#### 非空约束

1. `NOT NULL` 约束要求字段必须有值，不能为 `NULL`。



#### 默认值

1. 如果插入数据时没有为某字段赋值，则会自动使用该字段的默认值。



#### 外键约束

1. 定义了外键的表称为**从表**，被引用的表称为**主表**。

2. 从表中的外键字段的取值，必须是主表对应字段中已有的某个值，即只能引用主表已存在的数据（外键唯一性约束）。

3. 如果某个主表字段的值已经被从表引用，通常不能随意更新或删除该主表数据，否则会破坏数据之间的关联关系（外键参照完整性约束）。

   ```sql
   CREATE TABLE order_item_details (
       order_id   INT,
       product_id INT,
       detail     VARCHAR(100),
       -- 如果主表的主键是联合主键，且从表要引用这个主键作为外键时，外键就必须是联合外键
       -- 联合外键，引用 order_items 的联合主键
       FOREIGN KEY (order_id, product_id) REFERENCES order_items(order_id, product_id)
   );
   ```

   

#### 自动增长

1. **自动增长**（`AUTO_INCREMENT`）本质上是一种功能，而不是字段约束。
2. 对设置为自动增长的字段，插入数据时无需手动赋值，数据库会自动为其分配一个递增的数字（通常从1开始）。
3. 即使删除了某些记录，自动增长的序列不会回退，后续插入的数据仍会在上一个最大值基础上递增。
4. 自增ID就是这样，只会往后加，不会往前减



所以一个完整的表结构定义语句类似如下

```sql
CREATE TABLE IF NOT EXISTS users (
  	-- PRIMARY KEY 主键
    -- AUTO_INCREMEN 自动增长 「 非约束，要手动打 」
    id INT PRIMARY KEY AUTO_INCREMENT,
  
    -- UNIQUE 唯一
    -- NOT NULL 不为空
    name VARCHAR(20) UNIQUE NOT NULL,
  
    -- DEFAULT 设置默认值
    level INT DEFAULT 0,
  
  	-- 这里之所以使用字符串，是因为电话可能存在 地区前缀 「 如 +86 」
  	telephone VARCHAR(20) UNIQUE
  
    role_id INT,
  
  	-- 外键，引用 roles 表的 id 字段
    -- 通过 CONSTRAINT 定义外键名，不定义会自动生成一个外键名
    -- 将当前表的role_id 和 roles表的id字段关联
    -- roles.id对应值更新时，当前表的role_id一起更新，而当删除时，当前表的role_id设置为NULL
    CONSTRAINT fk_role
      FOREIGN KEY (role_id)
      REFERENCES roles(id)
      ON DELETE SET NULL
      ON UPDATE CASCADE
);
```



