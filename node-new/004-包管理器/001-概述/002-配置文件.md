package.json是个配置文件，用来记录项目的各种信息

如项目名，版本号，依赖了那些库等

```shell
npm init # 以交互配置方式生成package.json

npm init -y # 快速使用默认信息生成package.json
```

生成的`package.json`信息如下

```js
{
  // package.json里的字段是固定的，不能乱加
  // 除了name和version字段外，其余都是可选的
  
  // 项目名
  // 1. 仅可包含小写字母、数字和中划线（-）
  // 2. 不允许出现空格或大写字母
  // 3. 多词组合时，推荐使用中划线分隔
  // 4. 如果发布为库，则命名不能重复
  "name": "node-demo", 」
  "version": "1.0.0", // 版本号 「 使用semver格式 major.minor.path 即大版本.小版本.补丁号 」
  "description": "", // 项目描述信息
  "main": "index.js", // 项目主入口
  "scripts": { // 配置运行脚本
    // npm run start 实际执行的是 node index.js
    // 可以省略run的命令有：start、test、stop、restart。
    // 其他自定义命令使用时必须加上run关键字
    "start": "node index.js",
    // script中使用到的命令行工具会优先使用本地 node_modules/.bin 里的工具
    "build": "vite build"
  },
  "private": false, // 是否开源，默认false => 设置为true将阻止用户通过命令发布到npm仓库
  "keywords": [], // 项目关键词信息
  "author": "张三 <zhangsan@example.com>", // 作者
  "license": "ISC", // 开源协议
  "dependencies": { // 生产环境依赖
    "express": "^4.18.2" // ^ 锁定大版本
  },
  // 在生产环境，仅会安装 dependencies
  // 而在开发环境，会同时安装 dependencies 和 devDependencies
  "devDependencies": { // 生产环境依赖
    "nodemon": "~3.0.0" // ~ 锁定小版本
  },
  "repository": { // 代码仓库地址
    "type": "git",
    "url": "https://github.com/zhangsan/node-demo.git"
  },
  "bugs": { // 问题反馈地址
    "url": "https://github.com/zhangsan/node-demo/issues"
  },
  "homepage": "https://github.com/zhangsan/node-demo#readme", // 项目主页地址
  // 指定项目运行需要的引擎版
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  },
  // peerDependencies（对等依赖）
  // 用于声明本库需要依赖的“宿主库”及其版本，但不会自动安装或打包进来。
  // 这样既可以减少包体积，也能强制要求使用者在合适的环境下使用本库。
  // 常用于组件库或插件库，比如 element-plus 需要宿主项目安装 Vue，ant-design 需要 React。
  "peerDependencies": {
    "react": "^18.0.0"
  },
  
  // 目标浏览器版本 => 即项目需要运行到哪些版本的浏览器中
  // 通常写在 package.json 或单独的 .browserslistrc 文件里
  "browserslist": [
    "> 1%",
    "last 2 versions"
  ]
}
```

`package.json`本质是一个配置文件，所以一些框架或库会往期身上添加自定义配置

一些构建工具也是以特殊字段的方式将配置文件插入package.json中



## npx 

1. **本地查找**：npx 首先在当前目录的 `node_modules/.bin` 中查找命令。
2. **向上递归**：如果未找到，会依次向上查找父级目录的 `node_modules/.bin`，直到根目录为止。
3. **全局查找**：本地和父级目录都没有时，npx 会查找全局已安装的命令。
4. **临时下载**：如果依然找不到，npx 会临时从 npm 下载该工具包并执行。
5. **执行命令**：npx 运行找到或临时下载的命令。
6. **清理临时依赖**：执行结束后，npx 会自动移除临时下载的包。



## scripts 字段

- 在 `scripts` 中执行命令时，npm/yarn 会优先使用当前项目的 `node_modules/.bin` 目录下的工具。
- 如果当前目录没有，会递归向上查找父级目录的 `node_modules/.bin`，直到根目录。
- **不会自动临时安装依赖**，如果始终找不到对应命令，会直接报错。



## `.npmrc`

`pnpm`、`yarn`、`npm`等包管理器的配置文件

它采用 `key=value` 的格式，每一行代表一项配置。

`rc` 是 `run commands` 或 `run configuration` 的简写

`.npmrc` 文件可以存在于多个位置，优先级如下（从高到低）：

1. **项目级**：项目根目录下的 `.npmrc`（只影响当前项目）
2. **用户级**：用户主目录下的 `~/.npmrc`（影响当前用户的所有项目）
3. **全局级**：全局配置文件（如 `/etc/npmrc`，影响系统所有用户）
4. **内置默认**：npm 内置的默认配置

```shell
registry=https://registry.npmmirror.com/ # 默认库走官方路径
@test:registry=https://another.registry.com/ # 使用 `@test/` 开头的库走自定义仓库 
```



### npm scope

1. `@xxx` 是 npm 的 scope（作用域），用于分组管理包，方便团队协作和避免命名冲突。
2. 如果要发布团队/共有库，建议先在 npm 官网创建一个 organization（组织），比如 `xxx`。
3. 包名格式为 `@xxx/<库名>`。
4. 首次发布带 scope 的包时，需执行 `npm publish --access public` ，否则默认是私有包。普通包无需此参数。
5. 后续更新可以直接用 `npm publish`。

