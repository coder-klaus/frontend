如果我们希望将某部分代码提取出来作为公共库，以便在多个项目中共享，可以按照以下流程操作：

1. 在 Github 上托管源码。
2. 构建项目后，将其发布到 npm。



## 发布流程

1. 注册一个 `npm` 账号。
2. 使用`npm login`命令进行登录。
   - 注意：登录时，npm 源地址必须是官方源，不能使用淘宝源。
3. 通过`npm publish`命令进行发布或更新库。
   - 首次执行为发布操作。
   - 修改版本号后再次执行，则为更新操作。
4. 登录后，登录的 Token 会被存放在 `~/.npmrc` 文件中，因此我们不需要每次都重新登录。
   只有在 Token 过期或需要切换账号时才需要重新登录。
   可以通过 `npm whoami` 命令查看当前是否已经登录以及当前登录用户的信息。



## 命名规则

1. 只能包含小写字母、数字以及中划线（-）。
2. 包名不能以数字开头。
3. 多个单词之间必须使用中划线进行分隔。
4. 包名在全局范围内必须唯一，不能与已有的 npm 包名重复。
5. 只有存在 `package.json` 文件的目录才算作合法的包。



## 注意事项

1. npm 包和 github 仓库默认展示项目根目录下的 `README` 文件内容。
2. 执行 `npm publish` 时，除了 `node_modules`、`.git` 等特殊目录，其他所有内容都会被上传。  
   + 可以通过 `package.json` 的 `files` 字段或 `.npmignore` 文件进行限制。  
   + `files` 字段是白名单数组，指定哪些目录可以被上传。  
   + `.npmignore` 是忽略名单。  
     + 如果配置了 `files` 字段，则在 `files` 范围内再剔除不能上传的内容。  
     + 如果没有配置 `files` 字段，则在全部文件范围内剔除内容。  
   + 理论上，npm 包可以直接发布源码，不需要构建即可被下载和使用。但由于实际使用环境和模块系统多样，建议发布前用构建工具（如 rollup）将包打包成多种格式并优化后再发布，这样可以更好兼容不同场景。
3. 删除库  
   + `npm deprecate`  
     + 用于将库标记为废弃。  
     + 下载和 npm 页面会出现警告提示。  
     + 但库仍然可以被使用。  
   + `npm unpublish`  
     + 用于删除库的最新一个版本。  
     + 如果库只有一个版本，默认拒绝删除。  
     + 可以通过 `--force` 强制删除。  
       + 删除后 24 小时内，包名会被封存，任何人都无法使用此名称。  
       + 24 小时后，这个包名才会再次开放注册。
