默认读取到的内容是二进制数据，因为node不知道文件的MIME类型

```js
import fs from 'node:fs/promises';

const data = await fs.readFile('data.txt');

console.log(data); // <Buffer 48 65 6c 6c 6f 20 57 6f 72 6c 64 0a>
```



如果需要获取对应的字符串内容，有两种方式

1. 在调用API时，指定编码格式

   ```js
   import fs from 'node:fs/promises';
   
   // 在Node中 utf-8 和 utf8 是等价的
   const data = await fs.readFile('data.txt', 'utf-8');
   
   console.log(data); // Hello World
   ```

2. 调用 `Buffer` 的 `toString` 方法

   ```js
   import fs from 'node:fs/promises';
   
   const data = await fs.readFile('data.txt');
   
   // Buffer实例的 toString方法默认参数就是 utf-8
   console.log(data.toString()); // Hello World
   ```



读取文件时，`fs`要求文件必须存在，如果不存在会直接报错

```js
import fs from 'node:fs/promises';

try {
  const data = await fs.readFile('data.json');
  console.log(data.toString());
} catch (error) {
  // 如果文件不存在，会抛出错误
  console.error(error);
}
```



## 配置对象

在读取文件时，除了可以直接传入编码参数，还可以传入一个**配置对象**，以便同时指定更多选项。

配置对象格式为

```ts
{
  encoding?: string, // 可选，指定编码方式，如 'utf-8'
  flag?: 'r' | 'r+' | 'w' | 'w+' | 'a' | 'a+' // 可选，指定文件操作方式
}
```

示例

```js
import fs from 'node:fs/promises';

const data = await fs.readFile('data.txt', {
  encoding: 'utf-8', // 指定编码
  flag: 'r', // 指定文件操作方式
});

console.log(data) // Hello World
```



### encoding

计算机底层以二进制形式存储数据。

+ **编码**（Encoding）就是将字符（如汉字、英文字母、符号等）转换为二进制数据的过程
+ **解码**（Decoding）则是将二进制数据还原为对应字符的过程。

常见的编码方式有多种，比如 ASCII、GBK、UTF-8、UTF-16 等。

目前最常用的编码格式是 **UTF-8**，它是 Unicode 标准的一种实现方式。

> **编码和解码必须一致**。如果用某种编码方式写入文件，读取时也必须用相同的编码方式，否则会出现乱码或解析失败。



#### 关于 UTF-8 编码

- 英文字符（ASCII 范围）使用 1 个字节存储。
- 常用中文字符通常使用 3 个字节存储。
- 部分生僻汉字及 emoji 表情等，使用 4 个字节存储。



### flag

指定了操作文件的方式

| flag | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| `r`  | 只读。<br />文件必须存在，否则抛出异常。<br />`writeFile`的默认`flag`是`r` |
| `r+` | 可读可写。<br />文件必须存在，否则抛出异常。                 |
| `w`  | 只写。<br />如果文件不存在则创建，存在则清空。「 覆盖写入 」<br />`writeFile`的默认`flag`是`w` |
| `w+` | 可读可写。<br />如果文件不存在则创建，存在则清空。「 覆盖写入 」 |
| `a`  | 只写。<br />追加模式。如果文件不存在则创建。「 追加写入 」<br />`appendFile`的默认`flag`是`a` |
| `a+` | 可读可写。<br />追加模式。如果文件不存在则创建。「 追加写入 」 |

一般来说，`r+`、`w+`、`a+` 这些读写模式主要用于 Node.js 的底层文件操作 API。而在常用的高层 API 中，通常只需要用到 `r`、`w`、`a` 这三种基本模式。

