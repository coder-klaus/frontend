SQL 提供了聚合函数，能直接对数据集合做统计，比如算总数、最大值、最小值、平均值等等

简单来说，就是先查出一堆数据（集合），然后对这堆数据整体做统计。



```sql
-- 先查出华为手机的所有价格（一个数据集合），然后用 AVG 函数算出平均值，直接返回结果
-- ROUND 是功能函数，用于截取小数点 「 会四舍五入 」
SELECT ROUND(AVG(price), 2) FROM products WHERE brand = '华为';
```

```sql
-- 最大值
SELECT MAX(score) FROM products;

-- 最小值
SELECT MIN(score) FROM products;

-- 先查出评分最大值，再用评分最大值去查看具体是那个产品和其相关信息
-- 小括号用于提升 SQL 语句执行优先级 => 子查询
SELECT title FROM products WHERE score = (SELECT MAX(score) FROM products);
```

```sql
-- 求和
SELECT SUM(vote) FROM products;
```

```sql
-- 统计记录数

-- * 表示统计所有行，不管字段是不是空的
SELECT COUNT(*) FROM products WHERE brand = '华为';

-- 统计 title 有值的行数
SELECT COUNT(title) FROM products WHERE brand = '华为';
```



### 子查询

当我们使用聚合函数（如 `MAX(amount)`）时，如果在 `SELECT` 语句中同时查询其他非聚合字段（如 `brand`），会报错

假设表结构如下

![image-20250701162843619](https://s2.loli.net/2025/07/01/CKtT7LiNeAUSnWF.png) 



 如果我们执行

```sql
SELECT brand, MAX(amount) 
FROM orders;
```

这会出现如下错误（以 MySQL 为例） =>  `1054 - Unknown column 'brand' in 'field list'`

原因是：**在使用了聚合函数的情况下，SQL 查询结果只包含聚合后的字段，其他字段（如 `brand`）无法直接查询。**

此时数据表的结构类似于

![image-20250701162926049](https://s2.loli.net/2025/07/01/BQgyRxuWvSNPU8k.png) 



此时如果我们需要实现对应功能，就需要使用子查询

```sql
SELECT product
FROM orders
WHERE amount = (SELECT MAX(amount) FROM orders);
```

![image-20250701163604411](https://s2.loli.net/2025/07/01/PwMsCWQdyJOa1iK.png) 

