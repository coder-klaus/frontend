`fs` 「 file system 」模块的功能 => 操作目录和文件

+ 默认读取内容都是以十六进制显示的二进制Buffer数组
+ 可以在读取或写入的时候直接指定编码格式 「 一般为 utf-8 」
  + 读取的时候，也可以在读取完成后，手动调用`toString`转字符串
  + 在 node 中，`utf-8` 和 `utf8` 是等价的
+ 读取文件必须存在，否则直接报错



## 调用方式

node 的 api 都提供了 三种调用方式

1. 同步
2. 异步
   + 回调函数 「 不推荐，容易回调地狱 」
   + promise方式 「 推荐 」

> 三种调用方式，语法结构基本类似
>
> 后续仅列举 异步 promise的调用方式



### 同步

```jsx
// 加上 node:fs 前缀 表示使用 node 内置的 fs 模块
// + 如果只写fs，表示先找内置模块，不存在从当前 node_modules 中查找，然后逐层向上查找，直到根目录
// + 加上 node:fs 前缀 表示直接从 node 内置模块中查找，如果找不到直接报错
import fs from 'node:fs'

// 同步读取
// 参数一 => 文件路径，不存在则直接报错
// 参数二 => 编码格式，如果不指定，则返回 buffer 对象 「 十六进制表示的二进制数组 」

// 计算机以二进制形式存储所有文件内容。
// 在存储时，需要将原始内容（如文本、图片等）通过特定的编码方式转换为二进制数据（编码）。
// 读取时，需要用相同的编码方式将二进制数据还原为原始内容（解码）。
// 编码是把字符串变成二进制，解码是把二进制变回字符串。
// 如果编码和解码方式不一致，尤其在处理中文等多字节字符时，容易导致乱码问题。
const res = fs.readFileSync('data.txt', 'utf-8')
console.log(res)
```

```jsx
import fs from 'node:fs'

const res = fs.readFileSync('data.txt')

// 也可以读取buffer内容后，手动转字符串 「 这在异步API中写法是通用的 」
console.log(res.toString())
```

```js
import fs from 'node:fs'

// 如果需要传递多个参数，可以传入一个对象 「 这在异步API中写法是通用的 」
// + encoding 指定编码格式
// + flag 指定文件操作方式
const res = fs.readFileSync('data.txt', {
  encoding: 'utf-8',
  flag: 'r'
})

console.log(res)
```



### 异步

#### 回调函数

```js
import fs from 'node:fs'

// 异步读取 「 回调函数 」
// node 遵循 错误优先机制 => 回调函数第一个参数一定是错误信息
fs.readFile('data.txt', 'utf-8', (err, data) => {
  // 如果没有报错，则 err 为 null
  // 如果报错，则 err 为错误信息
  if (err) {
    console.log(err)
    return
  }
  
  console.log(data)
})
```



#### promise

```js
import fs from 'node:fs'

// 异步读取 「 promise方式 」
// fs.promises 是 fs 模块的 promise 版本
// fs.promises(<文件路径>， <编码格式>)
// 在 node 的顶层 可以直接使用 await 「 前提是 node模块使用的是 ESM，而不是 CJS 」
const res = await fs.promises.readFile('data.txt', 'utf-8')
console.log(res)
```

```js
// 直接导入 fs 模块的 promise 版本
import fs from 'node:fs/promises'

const res = await fs.readFile('data.txt', 'utf-8')
console.log(res)
```

