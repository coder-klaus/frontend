操作系统在底层打开每一个文件的时候，都会给这个文件分配一个独一无二的数字编号。

这个编号就叫“文件描述符”（File Descriptor，简称FD，也叫文件句柄）。

文件句柄是比较底层的概念。事实上，node任何 fs api 底层都是通过 文件句柄来实现的

> 在 unix系统中，打开文件关联一个唯一数字id，这个id就是文件描述符
>
> 在 window系统中，通过一个对象来实现相同功能，这个对象叫做文件句柄
>
> 在非promise api 中，open 获得到的是数字，即文件描述符
>
> 在 promise api 中，open 获取到的是一个对象，即文件句柄。后续所有操作都可以直接基于文件句柄进行操作

```js
import fs from 'node:fs/promises'

try {
  // open 方法会返回
  // + 早期写法，返回的是数字
  // + 现代写法「 即使用 fs.promises 模块时写法 」，返回的是文件描述符实例 「 文件句柄 实例 」
  const fd = await fs.open('data.txt', 'r')
  console.log(fd)
} catch (e) {
  if (e instanceof Error) {
    console.error(e.message)
  } else {
    console.error(e)
  }
}
```



后续操作基本一致

```js
import fs from 'node:fs/promises'

try {
  // 获取文件句柄
  const fd = await fs.open('data.txt', 'r')

  // 操作文件api中，任何可以传入文件路径的部分，也可以传入文件句柄
  const data = await fd.readFile({
    encoding: 'utf-8',
    flag: 'r',
    // 在 Node.js 中，所有可以用于新建文件或目录的 API（例如 open、writeFile、mkdir 等）都可以传入 mode 配置项。
    // 该选项用于设置新建文件或目录的权限，配置方式与 Unix 系统中的权限位完全一致（如 0o666、0o777）。
    //
    // mode 选项仅在新建文件或目录时生效，对已存在的文件或目录无效。
    // 其它操作（如读取 readFile 或删除 rmdir、unlink）没有 mode 配置项。
    // 若需修改已存在文件或目录的权限，应使用 chmod 相关 API。
    mode: '0o666'
  })

  console.log(data)

  // 文件句柄属于底层操作，不会自动关闭，需要手动关闭
  
  // 虽然当进程中止时，文件会自动关闭 ，此时我们就不需要调用close方法
  // 但是在实际开发中，node会作为常驻进程为客户端提供服务，如果不关闭的话很容易内容泄漏
  // 因此此时即使不在操作对应文件了，但对应文件在内存中一直处于打开的状态
  await fs.close(fd)
} catch (e) {
  if (e instanceof Error) {
    console.error(e.message)
  } else {
    console.error(e)
  }
}
```

```jsx
import fs from 'node:fs/promises'

try {
  const fd = await fs.open('data.txt', 'r')

  // 获取文件元数据「 如文件大小，创建时间，修改时间等 」时，只能通过文件句柄，不能通过文件路径
  // + 早期写法 fs.stat(fd, (err, metaData) => {})
  // + 现代写法 => fd.stat()
  const metaData = await fd.stat()

  console.log(metaData)

  // 关闭文件句柄
  // + 早期写法 fs.close(fd, (err) => {})
  // + 现代写法 => fd.close()
  await fd.close()
} catch (e) {
  if (e instanceof Error) {
    console.error(e.message)
  } else {
    console.error(e)
  }
}
```

