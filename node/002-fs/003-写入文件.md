```js
import fs from 'node:fs/promises'

try {
  // fs 读取文件时，文件不存在，直接报错
  // fs 写入文件时，文件不存在，会自动创建文件
  fs.writeFile('data.txt', 'hello world')
} catch (e) {
  if (e instanceof Error) {
    console.error(e.message)
  } else {
    console.error(e)
  }
}
```

```jsx
import fs from 'node:fs/promises'

try {
  // 第三个参数是配置对象
  // + flag 写入方式, 默认是 w, 会覆盖文件内容
  // + encoding 编码方式, 默认是 utf-8
  fs.writeFile('data.txt', '222', {
    // 写入和读取编码必须一致，以避免中午乱码
    flag: 'a'
  })
} catch (e) {
  if (e instanceof Error) {
    console.error(e.message)
  } else {
    console.error(e)
  }
}
```



```js
import fs from 'node:fs/promises'

// 在文件末尾追加内容
fs.appendFile('data.txt', 'hello world')
```





`flag`的常见取值

| 模式 | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| w    | 写入文件时的默认值<br />只能写入，不能读取<br />文件不存在，新建文件<br />覆盖原本文件内容 |
| w+   | 可读可写<br />文件不存在，新建文件<br />覆盖原本文件内容     |
| r    | 读取文件时的默认值<br />只能读取，不能写入<br />文件不存在，直接报错 |
| r+   | 可读可写<br />文件不存在，直接报错                           |
| a    | `appendFile`中`flag`配置项的默认值<br />追加<br />文件不存在，新建文件 |
| a+   | 追加<br />文件不存在，新建文件                               |

> **只有用底层 API（如 `fs.open` 得到 fd）时，flag 的“可读可写”权限才真正有用。**
>
> **高层 API（如 `readFile`、`writeFile`）和常见的流操作，flag 只决定能不能打开文件，不涉及复杂的权限组合。**
>
> **一般情况下，只要使用`a`、`w`、`r`即可**