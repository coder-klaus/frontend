Node.js 的核心 API 大多都是基于异步事件驱动机制实现的，而这些核心 API 底层都是基于 event 模块 实现

在 event 模块中 实现了事件绑定相关 API 的实现



## 基本使用

```js
import { EventEmitter } from 'events'

// 创建一个事件发射器
const emitter = new EventEmitter()

// 监听事件 「 老版本名 addListener，向后兼容，同时可用，推荐使用on 」
emitter.on('customEvent', (...args) => {
  console.log(args) // [ 'Hello, world!', 'Hello, node.js!' ]
})

// 事件监听回调可以存在多个，会被整合为数组，并被依次回调
emitter.on('customEvent', (...args) => {
  console.log(args) // [ 'Hello, world!', 'Hello, node.js!' ]
})

// 发射事件
// + 对应事件 可以依次传递多个参数，也可以整合为一个对象将参数进行统一传递
// + 这个参数对象 一般叫做 payload 负载参数
emitter.emit('customEvent', 'Hello, world!', 'Hello, node.js!')
```

```js
import { EventEmitter } from 'events'

const emitter = new EventEmitter()

function handler() {
  console.log('handler')
}

emitter.on('customEvent', handler)

// 控制台输出 handler
emitter.emit('customEvent', 'Hello, world!', 'Hello, node.js!')

// 移除事件监听 「 注意: 事件需要与注册时一致，底层通过类似于findindex的方式进行查找 」
// 「 老版本名 removeListener，向后兼容，同时可用，推荐使用off 」
emitter.off('customEvent', handler)

// 控制台不输出 handler
emitter.emit('customEvent', 'Hello, world!', 'Hello, node.js!')
```



## 不常用的属性和方法

```js
import { EventEmitter } from 'events'

const emitter = new EventEmitter()

emitter.on('customEvent', () => console.log('handler1'))
emitter.on('customEvent', () => console.log('handler2'))

// 获取事件名称组成的数组
console.log(emitter.eventNames()) // [ 'customEvent' ]

// 获取事件监听器数量
console.log(emitter.listenerCount('customEvent')) // 2

// 获取某一具体事件绑定的所有监听器组成的数组
console.log(emitter.listeners('customEvent')) // [ [Function (anonymous)], [Function (anonymous)] ]

// 获取最大监听器数量 「 默认是10 」
// 超出时，最近最少使用的那个事件绑定函数会被移除
console.log(emitter.getMaxListeners()) // 10

// 设置最大监听器数量
emitter.setMaxListeners(100)
console.log(emitter.getMaxListeners()) // 100
```

```jsx
import { EventEmitter } from 'events'

const emitter = new EventEmitter()

// 注册事件监听器 「 只触发一次 」
emitter.once('customEvent', () => console.log('handler'))

// 控制台只会输出依次 handler
emitter.emit('customEvent')
emitter.emit('customEvent')
```

```js
import { EventEmitter } from 'events'

const emitter = new EventEmitter()

emitter.on('customEvent', () => console.log('handler'))

// 在事件监听器列表的开头添加一个监听器
// 同样存在对应的 prependOnceListener 方法
emitter.prependListener('customEvent', () => console.log('prepend'))

emitter.emit('customEvent')
/* 
  prepend
  handler
*/
```

```js
import { EventEmitter } from 'events'

const emitter = new EventEmitter()

emitter.on('customEvent', () => console.log('handler1'))
emitter.on('customEvent', () => console.log('handler2'))
emitter.on('customEvent', () => console.log('handler3'))

// 移除某一个具体事件绑定的所有事件监听
emitter.removeAllListeners('customEvent') // 只有 removeAllListeners 没有 offAll

// 控制台，不会输出任何内容
emitter.emit('customEvent')
```

```js
import { EventEmitter } from 'events'

const emitter = new EventEmitter()

emitter.on('customEvent1', () => console.log('handler1'))
emitter.on('customEvent2', () => console.log('handler2'))
emitter.on('customEvent3', () => console.log('handler3'))

// 移除所有事件对应的监听器
emitter.removeAllListeners()

// 控制台，不会输出任何内容
emitter.emit('customEvent1')
emitter.emit('customEvent2')
emitter.emit('customEvent3')
```

