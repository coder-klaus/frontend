```js
import fs from 'fs';

// 如果文件不存在，则创建文件
const stream = fs.createWriteStream('./data.txt', {
  highWaterMark: 3, // 每次最多写入 3 个字节
  encoding: 'utf-8', // 写入的编码
  // 流会多次写入，所以是 flags，不是 flag
  flags: 'a', // 追加写入 「 默认值依旧是 w 」
})

// 写入数据
stream.write('123')
stream.write('456')
stream.write('789')

// 写入完成并关闭写入流
// 和读取流不一样，写入流必须手动告诉node，数据写入完毕了
stream.close()
```

```js
import fs from 'fs';

const stream = fs.createWriteStream('./data.txt', {
  highWaterMark: 3,
  encoding: 'utf-8',
  // 模式为 w 时，会覆盖文件内容
  // 在整个流写入的过程中，第一次是替换，后续是追加，直到整个流写入完成
  flags: 'w',
})

stream.write('123')
stream.write('456')
// 写入完成后，关闭流
stream.end('789') // 等价于 stream.write('789') + stream.close()
```

```js
import fs from 'fs';

const stream = fs.createWriteStream('./data.txt', {
  // 从第 3 个字节开始写入
  start: 3,
  // 只有 flags 为 r+、a+、a 的时候，start 才会生效
  // 如果是 w+ 或者 w 的时候，写入会存在问题。=> 此时是替换，不是追加
  flags: 'w+',
})

// 假设初始文件内容为 123456789
// 写入 abc 后，文件内容为 123abc789
stream.end('abc')
```

```js
import fs from 'fs';

const stream = fs.createWriteStream('./data.txt', {
  // 从第 3 个字节开始写入
  start: 3,
  // 只有 flags 为 r+、a+、a 的时候，start 才会生效
  // 如果是 w+ 或者 w 的时候，行为是替换，此时会导致start配置参数生效失败，写入后得到错误结果
  flags: 'w+',
})

// 假设初始文件内容为 123456789
// 写入 abc 后，文件内容为 123abc789
stream.end('abc')
```

```js
import fs from 'fs';

const stream = fs.createWriteStream('./data.txt')

// 写入内容时 \n 会被当做换行符处理
// node会自动转换为对应系统的换行符
// + 老版本mac, \n => \r
// + windows, \n => \r\n
// + linux 和 新版mac, \n => \n
stream.write('123\n')
stream.write('456\n')
stream.end('789\n')

// 写入文件被打开
stream.on('open', fd => {
  console.log('open', fd)
})

// 写入文件发生错误
stream.on('error', (err) => {
  console.log('error', err)
})

// 写入文件完成
// 先回调 finish事件 表示写入完成，再回调 close 事件，表示文件被关闭

// 读取流读取完成时触发end方法，而写入流写入完成触发finish
// 避免被认为是调用 stream.end() 后单独触发的事件回调
stream.on('finish', () => {
  console.log('finish')
})

// 写入文件被关闭
// 在调用 stream 的 end、close、destory 方法后，会触发 close 事件
stream.on('close', () => {
  console.log('close')
})
```

```js
import fs from 'fs';

const stream = fs.createWriteStream('./data.txt')

// write 和 end 也支持回调函数
stream.write('123', error => {
  if (!error) {
    console.log('123写入成功')
  } else {
    console.log('写入失败', error)
  }
})

stream.end('456', error => {
  if (!error) {
    console.log('456写入成功')
  } else {
    console.log('写入失败', error)
  }
})
```

```js
import fs from 'fs';

const readStream = fs.createReadStream('./data.txt')
const writeStream = fs.createWriteStream('./data-copy.txt')

// 实现复制功能
// 方式一 通过 readFile + writeFile
// 方式二 通过 createReadStream + createWriteStream
// 方式三 通过 pipe

// 通过读取流建立管道，把可读流中的数据直接传输到可写流中
readStream.pipe(writeStream)
```

