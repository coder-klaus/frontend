![image-20250618160042405](https://s2.loli.net/2025/06/18/xuBb7G8wtaZDhRF.png) 

存放 网页所需要资源的服务器 就是 web 服务器

当我们通过客户端通过 HTTP 请求对应资源时，web服务器会返回对应资源

+ 如果返回的是 html、css、js 这种每次返回结果内容都是固定的服务器，就叫静态服务器
+ 如果返回的是 api数据，每次请求返回结果可能是不固定的服务器，就叫动态服务器 「 api 服务器 」



服务器本质就是一台运行特定服务的电脑。可以是你本地的机器，也可以是云上的虚拟主机。

+ 服务器一般 7 * 24 不关机，为用户提供服务
+ 一台服务器可以通过监听多个端口的形式，提供多种服务
+ 每台服务器对应一个公网出口IP，一般也存在对应域名「 会被映射为 IP地址 」
+ web服务一般默认端口为 http => 80, https => 443



```js
import http from 'node:http'

// 创建一个http服务器，返回一个 Server 实例
// 参数是一个回调函数，当客户端向服务器发送请求时，就会回调这个函数
// 默认这个函数会被回调两次
// + index.html
// + /favicon.ico

// 这个回调函数有两个参数
// + req 是 Request 实例，表示客户端的请求，是基于可读流封装的对象
// + res 是 Response 实例，表示服务器的响应，是基于可写流封装的对象
const server = http.createServer((req, res) => {
  // 设置响应头 告诉浏览器，我给你的是html，并且字符集是utf-8
  // 避免中文乱码

  // 解析规则
  // 1. 判断html中 是否存在 <meta charset="UTF-8">
  // 2. 如果不存在，判断响应头的 Content-Type 是否是 text/html; charset=utf-8
  // 3. 如果还没有，则使用浏览器默认编码 「 一般是 ISO-8859-1，不是 UTF-8 」
  res.setHeader('Content-Type', 'text/html; charset=utf-8')

  res.end('你好~')
})

// 监听端口，启动服务器
// 第一个参数是端口号
// + 端口号可以设置的值为 0-65535 => 端口使用2个字节表示，可以表示的值为 255 * 255 = 65535
// + 0-1024 是系统保留的端口号或用于知名服务「 如 http(80)、https(443)、ssh(22)、ftp(21)等 」，一般不使用
// + 1025-65535 是用户可以设置的端口号
// 第二个参数是可选的，值是一个在服务启动成功后执行的回调函数
server.listen(3000, () => {
  // 启动 HTTP 服务后，程序不会自动结束，它会一直运行并等待接收请求。
  // 直到你手动关闭，或者程序崩溃
  console.log('server is running at http://localhost:3000')
  // 关闭服务器
  // server.close()
})
```



`createServer`底层执行的本质是 `new Server`

```js
import http from 'node:http'
// os 包含了node所允许的操作系统相关的信息
import os from 'node:os'

let ip = ''

// os.networkInterfaces() 获取本机所有网卡信息
// 结构为 Record<string, os.NetworkInterfaceInfo[]>
// 其中 key 为网卡名称，value 为网卡信息数组
Object.values(os.networkInterfaces()).forEach(instances => {
  const ipInstance = instances.find(instance => {
    // family 为 IPv4 或 IPv6
    // internal 为 true 表示是回环地址 「 如 127.0.0.1 」
    return !instance.internal && instance.family === 'IPv4'
  })

  if (ipInstance) {
    // 获取到第一个非回环地址
    ip = ipInstance.address
  }
})

const server = http.createServer((req, res) => {
  res.setHeader('Content-Type', 'text/html; charset=utf-8')
  res.end('你好~')
})

// 参数 1 为端口号 「 可选 」 不填会随机分配
// 参数 2 为 ip 地址 「 可选 」
// + 可以设置的值为
//    - 127.0.0.1 也可以是其别名 localhost
//      + 发出去的数据会直接被自己拦截并返回自己，不经过真实网络
//      + 所以只能通过本机访问, 局域网中其余主机将无法访问
//    - 0.0.0.0 当前局域网中所有设备都可以访问
//      + 通过局域网 ip 地址访问
//      + 如果不设置，0.0.0.0 就是默认值
//    - 具体的某一个 ip 地址 「 如 192.168.1.100 」
// 参数 3 为回调函数 「 可选 」
server.listen(3000, ip, () => {
  console.log(`server is running at http://${ip}:3000`)
})
```

```js
import http from 'node:http'

const server = http.createServer((req, res) => {
  res.setHeader('Content-Type', 'text/html; charset=utf-8')
  res.end('你好~')
})

server.listen(() => {
  const serverInfo = server.address()

  console.log(serverInfo)
  /*
    {
      address: '0.0.0.0', // ip地址
      port: 3000, // 端口号
      family: 'IPv4' // 协议族
    }
  */

  console.log(`server is running at http://${serverInfo.address}:${serverInfo.port}`)
})
```

