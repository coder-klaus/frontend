## 响应数据

`Response`继承自可写流，而可写流继承自`EventEmitter`

因此向用户代理写数据方式也有两种

+ `write` => 向客户端写入数据，但不关闭写入流，方便后续继续向客户端写入数据
+ `end` => 向客户端写入数据后直接关闭写入流，标识写入完成
  + 只有调用了`end`方法才表示响应结束，否则客户端会因为响应没有结束而一致转圈
    + 即 响应流 一直处于 开启状态，意味着客户端将持续等待数据的传输
    + 因此推荐客户端在向服务器发请求的时候，设置 5 - 10 秒左右的超时时间，避免客户端一直处于转圈情况
  + 虽然`Response`对象继承自可写流，但`Response`移除了可写流的`close`方法。
    + 换句话来说，对于`Response`只能通过`end`方法来进行关闭，不能通过`close`方法来进行关闭

```js
import http from 'node:http'

const server = http.createServer((req, res) => {
  res.setHeader('Content-Type', 'text/html; charset=utf-8')

  // 写入响应体, 写入成功后执行回调
  res.write('hello', () => {
    console.log('hello')
  })

  // 写入响应体并关闭响应流, 写入并关闭成功后执行回调
  res.end('world', () => {
    console.log('world')
  })
})

server.listen(3000)
```



## 设置响应码

响应状态码是一个用于表示请求结果的数字代码，通常被称为HTTP状态码。

客户端可以根据服务器返回的状态码来判断请求的处理结果。

```js
import http from 'node:http'

const server = http.createServer((req, res) => {
  // 不同代理使用的编码格式可能不一样，对于中文的默认解析规则可能也不一样
  // 因此显示指定客户端解析时采用的编码为 utf-8，避免客户端使用自己的默认编码格式进行解析
  // 以统一渲染结果
  // Content-Type 即是 响应头 也是 请求头
  res.setHeader('Content-Type', 'text/html; charset=utf-8')

  // 设置状态码 和 状态消息
  res.statusCode = 201
  res.statusMessage = 'Created' // 状态消息很少设置，因为设置了状态码，状态消息会自动更新

  // 设置响应体
  res.end('hello world')
})

server.listen(3000)
```

```js
import http from 'node:http'

const server = http.createServer((req, res) => {
  // writeHead设置响应头「 等价于 statusCode + setHeader 」
  // 参数一 状态码
  // 参数二 状态消息 「 可以省略 」
  // 参数三 响应头信息 「 可以省略 」
  res.writeHead(200, {
    'Content-Type': 'text/html; charset=utf-8'
  })
  res.end('hello world')
})

server.listen(3000)
```



### 常见响应码

+ `2xx` => 成功
+ `3xx` => 重定向
+ `4xx` => 客户端错误
+ `5xx` => 服务器错误

| 状态码 | 描述                  | 说明                                                         |
| ------ | --------------------- | ------------------------------------------------------------ |
| 200    | OK                    | 请求成功，服务器返回所请求的数据。                           |
| 201    | Created               | 请求成功且资源已创建。                                       |
| 204    | No Content            | 请求成功，但响应不包含内容。                                 |
|        |                       |                                                              |
| 301    | Moved Permanently     | 资源已永久移动到新URL。<br />更新用户代理缓存地址<br />请求新URL时，请求方式可以发生改变 |
| 302    | Found                 | 资源临时移动，客户端应使用新URL。<br />不更新用户代理缓存地址，下次还是请求源地址<br />因为资源可能被转移回来了<br />请求新URL时，请求方式可以发生改变 |
| 307    | Temporary Redirect    | 临时重定向<br />请求新URL时，请求方式不能改变<br />用于替代 状态码 302 |
| 308    | Permanent Redirect    | 永久重定向<br />请求新URL时，请求方式不能改变<br />用于替代 状态码 301 |
| 304    | Not Modified          | 资源未更改，客户端可使用缓存。                               |
|        |                       |                                                              |
| 400    | Bad Request           | 请求语法错误，服务器无法理解。                               |
| 401    | Unauthorized          | 请求需要用户认证。                                           |
| 403    | Forbidden             | 服务器拒绝请求，客户端无权限。                               |
| 404    | Not Found             | 服务器找不到请求的资源。                                     |
| 405    | Method Not Allowwed   | 请求方法（如GET、POST）不被服务器允许。                      |
| 429    | Too Many Requests     | 客户端发送过多请求，超出限额。                               |
|        |                       |                                                              |
| 500    | Internal Server Error | 服务器内部错误，无法完成请求。                               |
| 502    | Bad Gateway           | 作为网关或代理的服务器收到无效响应。                         |
| 503    | Service Unavailable   | 服务器暂时无法处理请求（如维护或过载）。                     |
| 504    | Gateway Timeout       | 网关或代理服务器未及时收到响应。                             |







