使用 http 模块编写 web服务器 过于繁琐。一般基于现有框架进行开发

在Node.js中，有两个非常流行的框架，一个是express，另一个是koa。

koa 和 express 底层是一致的，唯一区别是 koa更轻量级，中间件按需手动安装，而express会集成一部分中间件



express和koa的核心都是中间件 「 middleware 」。中间件本质都是一系列函数

这些函数会在实际处理请求或返回响应之前对请求体和响应体进行二次处理

中间件的参数是请求体或响应体，返回值是处理后的请求体和响应头，因此中间件可以链式调用



大部分时候，使用 express 或 koa 开发时，你无需自己编写中间件，只需要编写核心业务逻辑即可。

因为绝大部分通用功能，都可以使用 框架内置或社区提供的 中间件来完成



koa 和 express 也有对应脚手架 「 具体使用 可以查阅文档 」

+ express-generator => 官方 => `CLI`中存在命令行工具`express`
+ koa-generator => 社区 => `CLI`中存在命令行工具`koa`



## 初体验

```shell
npm install express
```



`main.js`

```js
// 导入express
import express from 'express';

// 创建express实例
const app = express();

// 创建后端路由
// 如果访问了不存在的路由或使用了未被支持的请求方式，Express 会自动处理，返回错误状态码（通常是 404）和简单的错误页面。

// 在express中，每个路由和请求方法的处理都是分开的。
// 不需要像 原生http模块那样 把所有的逻辑放在一个回调函数中
app.post('/login', (req, res) => {
  // 返回响应体，并结束请求 「 Content-Type 的值为 text/plain 」
  res.end('login');
});

// 回调函数也可以接收 请求体对象 和 响应体对象
// 他们是基于原生http模块的 请求体对象 和 响应体对象 并进行了功能扩展
app.get('/products', (req, res) => {
  const products = [
    { id: 1, name: 'iphone', price: 1000 },
    { id: 2, name: 'ipad', price: 2000 },
    { id: 3, name: 'macbook', price: 3000 },
  ]

  // 1. 自动设置响应头 Content-Type: application/json
  // 2. 自动将对象转换为 JSON 字符串
  // 3. 自动设置状态码 200
  // 4. 返回响应体，并结束请求
  res.json(products)
});

// 假设请求路径为 /profile/123?name=张三&age=20
app.get('/profile/:id', (req, res) => {
  // 获取请求参数
  const id = req.params.id // => 123
  const query = req.query // => { name: '张三', age: '20' }
  res.json({
    id,
    query,
  })
})

// 启动服务器
app.listen(3000, () => {
  console.log('Server is running on port 3000');
});
```

