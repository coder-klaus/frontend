## 子路由

路由过多，放一个文件中不好维护，可以使用`express.router`进行拆分

`express.rotuer`是一个有完整路由和中间件的 迷你express 应用

实际开发时，对应子路由一般存放于`router`或`routes`目录下

```js
import express from 'express'

const app = express()

// 创建子路由 => 本质是一个中间件
const userRouter = express.Router()

// 定义后端子路由 => 根据路由去匹配对应逻辑处理函数 「 controller 」
// 1. 子路由必须是以 / 开头  2. 请求体中的url是不包含子路由基准路径的
// 在本例中 访问 /users/list 则会匹配以下的逻辑处理函数
userRouter.get('/list', (req, res) => {
  console.log(req.url) // => '/list?limit=10&offset=0'
  console.log(req.path) // => '/list'
  console.log(req.baseUrl) // => '/users'
  console.log(req.originalUrl) // => '/users/list?limit=10&offset=0'
  console.log(req.params) // => {}
  console.log(req.query) // => { limit: '10', offset: '0' }
})
userRouter.post('/create', (req, res) => res.end(req.url)) // => '/create'
userRouter.patch('/:id', (req, res) => res.end(req.url)) // => '/<id>'

// 应用子路由 => 参数一就是 子路由的基准路径
app.use('/users', userRouter)

app.listen(3000)
```



## 静态资源

将对应目录设置为静态资源后，就可以通过文件名获取对应文件内容后再交给浏览器进行解析

```js
import express from 'express'

const app = express()

// 将对应目录设置为静态资源 「 可以设置多个 」
app.use(express.static('./uploads'))
app.use(express.static('./build'))

app.listen(3000)
```



## 错误处理

### 实现方案

**方式一：HTTP状态码 + 错误信息**

+ 直接利用HTTP协议的标准状态码（如404、500等）表示错误类型。
+ 响应体可以是文本或JSON，通常包含错误的详细描述。
+ 客户端可以根据HTTP状态码直接判断请求是否成功或失败。

```js
res.status(404).send('这是错误描述信息')
```



**方式二：始终返回200 + 自定义错误码**

1. HTTP响应状态码始终为200（即请求本身成功）。
2. 响应体为JSON对象，包含自定义的`code`和`message`字段（以及业务数据）。
3. 前端根据返回的自定义`code`判断业务是否成功。

```js
res.json({
  code: 404,
  message: '这是结果描述信息',
  data: null
})
```

方式二的好处是 状态码 和 描述信息 可以根据实际业务进行完全的定制化操作



### 错误处理中间件

```js
import express from 'express'

const app = express()

app.post('/login', (req, res, next) => {
  const { name, password } = req.body

  if (!name || !password) {
    // next在被调用时可以传递任何参数
    // 一旦传递参数，就会触发错误处理中间件
    next(-1001)
  } else {
    res.send('登录成功')
  }
})

// 错误处理中间件 => 比普通中间件多一个参数，表示错误信息
app.use((err, req, res, next) => {
  switch (err) {
    case -1001:
      res.send('用户名或密码不能为空')
      break
    case -1002:
      res.send('用户名或密码错误')
      break
    case -1003:
      res.send('用户名不存在')
      break
    default:
      res.send('未知错误')
  }
})

app.listen(3000)
```



